{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "landingPage": "/wp-admin/",
  "login": true, 
  "plugins":[ "seriously-simple-podcasting" ],
  "steps": [

    {
      "step": "mkdir",
      "path": "/wordpress/wp-content/plugins/gt-podcast-bb"
    },
    {
      "step": "writeFile",
      "path": "/wordpress/wp-content/plugins/gt-podcast-bb/gt-podcast-bb.php",
      "data": {
        "resource": "file",
        "path": "gt-podcast-bb.php"
      }
    },
    {
      "step": "writeFile",
      "path": "/wordpress/wp-content/plugins/gt-podcast-bb/template-code.html",
      "data": {
        "resource": "file",
        "path": "template-code.html"
      }
    },
    {
      "step": "cp",
      "fromPath": "/wordpress/wp-content/plugins/gt-podcast-bb/public",
      "toPath": "/wordpress/wp-content/plugins/gt-podcast-bb/public"
    },
    {
      "step": "activatePlugin",
      "pluginPath": "gt-podcast-bb/gt-podcast-bb.php"
    },
    {
      "step": "runPHP",
      "code": "<?php\n// Set up podcast options\nupdate_option('ss_podcasting_data_description', 'Welcome to the Gutenberg Times Podcast - your source for the latest WordPress block editor news, tips, and tutorials. Join us as we explore the evolving world of WordPress and the Gutenberg editor.');\nupdate_option('ss_podcasting_data_image', 'https://picsum.photos/400/400?random=1');\n\n// Register podcast post type if not exists\nif (!post_type_exists('podcast')) {\n    register_post_type('podcast', array(\n        'public' => true,\n        'label' => 'Podcasts',\n        'supports' => array('title', 'editor', 'excerpt', 'thumbnail', 'custom-fields'),\n        'has_archive' => true,\n        'rewrite' => array('slug' => 'podcast'),\n        'show_in_rest' => true\n    ));\n}\n\n// Flush rewrite rules\nflush_rewrite_rules();\n?>"
    },
    {
      "step": "runPHP",
      "code": "<?php\n// Create sample podcast posts\nfor ($i = 1; $i <= 5; $i++) {\n    $post_id = wp_insert_post(array(\n        'post_title' => 'Episode ' . $i . ': Block Editor Updates and News',\n        'post_content' => 'In this episode, we discuss the latest updates to the WordPress block editor, including new block variations, improved accessibility features, and upcoming changes in WordPress 6.7. We also explore how block bindings are revolutionizing dynamic content in WordPress themes and plugins.',\n        'post_excerpt' => 'Latest WordPress block editor news and updates for Episode ' . $i,\n        'post_type' => 'podcast',\n        'post_status' => 'publish',\n        'post_date' => date('Y-m-d H:i:s', strtotime('-' . ($i * 7) . ' days'))\n    ));\n    \n    if ($post_id) {\n        // Add podcast metadata\n        update_post_meta($post_id, 'date_recorded', date('Y-m-d', strtotime('-' . ($i * 7 + 2) . ' days')));\n        update_post_meta($post_id, 'audio_file', 'https://archive.org/download/podcast_episode_' . $i . '/episode_' . $i . '.mp3');\n        \n        // Create and attach cover image\n        $image_url = 'https://picsum.photos/300/300?random=' . ($i + 10);\n        $upload_dir = wp_upload_dir();\n        $image_data = file_get_contents($image_url);\n        $filename = 'episode-' . $i . '-cover.jpg';\n        $file_path = $upload_dir['path'] . '/' . $filename;\n        \n        if (file_put_contents($file_path, $image_data)) {\n            $attachment = array(\n                'post_mime_type' => 'image/jpeg',\n                'post_title' => 'Episode ' . $i . ' Cover',\n                'post_content' => '',\n                'post_status' => 'inherit'\n            );\n            \n            $attach_id = wp_insert_attachment($attachment, $file_path, $post_id);\n            if ($attach_id) {\n                require_once(ABSPATH . 'wp-admin/includes/image.php');\n                $attach_data = wp_generate_attachment_metadata($attach_id, $file_path);\n                wp_update_attachment_metadata($attach_id, $attach_data);\n                update_post_meta($post_id, 'cover_image_id', $attach_id);\n            }\n        }\n    }\n}\necho 'Created 5 sample podcast episodes with metadata';\n?>"
    },
    {
      "step": "runPHP",
      "code": "<?php\n// Create a custom archive page using the block template\n$archive_page_id = wp_insert_post(array(\n    'post_title' => 'Podcast Archive',\n    'post_content' => '',\n    'post_type' => 'page',\n    'post_status' => 'publish',\n    'post_name' => 'podcast-archive'\n));\n\nif ($archive_page_id) {\n    // Set as homepage for demonstration\n    update_option('show_on_front', 'page');\n    update_option('page_on_front', $archive_page_id);\n    echo 'Created podcast archive page';\n}\n?>"
    },
    {
      "step": "setSiteOptions",
      "options": {
        "blogname": "GT Podcast Demo",
        "blogdescription": "Demonstrating WordPress Block Templates with Podcast Block Bindings",
        "permalink_structure": "/%postname%/"
      }
    }
  ]
}